import pefile

default_dlls = [
    'ntdll',
    'kernel32',
    'advapi32',
    'user32',
    'shell32',
    'urlmon',
    'wininet',
    'ws2_32',
    'wininet',
    'winhttp',
    'userenv',
    'crypt32',
    'bcrypt',
    'oleaut32',
    'ole32',
    'iphlpapi',
    'ncrypt',
    'shlwapi',
    'netapi32',
]

def get_api_names(dll_name, path='C:\\Windows\\System32\\'):
    try:
        pe = pefile.PE(path + '%s.dll' % dll_name, fast_load=True)
        pe.parse_data_directories()
        res = []
        for exp in pe.DIRECTORY_ENTRY_EXPORT.symbols:
            if isinstance(exp.name, bytes):
                res.append(exp.name)
        return res
    except:
        return []
def get_dll_hashes(calc_hash, dll_list=default_dlls, table={}):
    for dll in dll_list:
        for name in get_api_names(dll):
            table[calc_hash(name)] = name

    
    return table
